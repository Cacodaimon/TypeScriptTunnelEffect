var GameManager=function(){function a(){this.initialized=!1,this.lastTimeStamp=(new Date).getTime(),this.delta=0,this.gameObjects=[]}return a.prototype.add=function(a){this.initialized&&a.init(this),this.gameObjects.push(a)},a.prototype.init=function(a){this.screen=new GameScreen(a.width,a.height),this.ctx=a.getContext("2d"),this.initialized=!0;for(var b=this.gameObjects.length-1;b>=0;b--)this.gameObjects[b].init(this)},a.prototype.update=function(){for(var a=this.gameObjects.length-1;a>=0;a--)this.gameObjects[a].update(this.delta)},a.prototype.draw=function(){for(var a=this.gameObjects.length-1;a>=0;a--)this.gameObjects[a].draw(this.ctx)},a.prototype.timerStart=function(){this.delta=(new Date).getTime()-this.lastTimeStamp,this.delta*=.01},a.prototype.timerEnd=function(){this.lastTimeStamp=(new Date).getTime()},a}(),GameScreen=function(){function a(a,b){this.width=a,this.height=b}return a}(),GameObject=function(){function a(){}return a.prototype.init=function(a){this.gameManager=a},a.prototype.update=function(){},a.prototype.draw=function(){},a}(),__extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},FPSDisplay=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.init=function(b){a.prototype.init.call(this,b),this.seconds=-1,this.fps=0},b.prototype.update=function(){var a=(new Date).getSeconds();this.seconds==a?this.fpsCounter++:(this.fps=this.fpsCounter,this.fpsCounter=0,this.seconds=a)},b.prototype.draw=function(a){a.fillStyle="#000",a.font="bold 14px Curier",this.fps&&a.fillText(""+this.fps,10,15)},b}(GameObject),LookUpTable=function(a){function b(){a.apply(this,arguments),this.bufferAngle=null,this.bufferDistance=null,this.bufferDepth=null,this.dataViewAngle=null,this.dataViewDistance=null,this.dataViewDepth=null}return __extends(b,a),b.prototype.init=function(b){a.prototype.init.call(this,b);var c=b.screen.width,d=b.screen.height,e=256/(2*Math.PI),f=new Vector2(c/2,d/2),g=256/f.sub(new Vector2).magnitude();this.bufferAngle=new ArrayBuffer(c*d),this.dataViewAngle=new DataView(this.bufferAngle),this.bufferDistance=new ArrayBuffer(c*d),this.dataViewDistance=new DataView(this.bufferDistance),this.bufferDepth=new ArrayBuffer(c*d),this.dataViewDepth=new DataView(this.bufferDepth);for(var h=0;c>h;h++)for(var i=0;d>i;i++){var j=f.sub(new Vector2(h,i)),k=h+i*c,l=j.magnitude();this.dataViewAngle.setUint8(k,j.angle()*e),this.dataViewDistance.setUint8(k,18e3/l),this.dataViewDepth.setUint8(k,l*g)}},b}(GameObject),LookUpTableRender=function(a){function b(){a.apply(this,arguments),this.lookUpTable=null,this.imageData=null}return __extends(b,a),b.prototype.init=function(b){a.prototype.init.call(this,b),this.lookUpTable=new LookUpTable,this.lookUpTable.init(b)},b.prototype.draw=function(a){this.imageData=this.imageData?this.imageData:a.getImageData(0,0,this.gameManager.screen.width,this.gameManager.screen.height);for(var b=this.lookUpTable.dataViewAngle,c=this.lookUpTable.dataViewDistance,d=this.lookUpTable.dataViewDepth,e=0;e<this.gameManager.screen.width;e++)for(var f=0;f<this.gameManager.screen.height;f++){var g=e+f*this.gameManager.screen.width;this.setPixel(e,f,b.getUint8(g),c.getUint8(g),d.getUint8(g),255)}a.putImageData(this.imageData,0,0)},b.prototype.setPixel=function(a,b,c,d,e,f){var g=a+b*this.imageData.width<<2;this.imageData.data[g]=c,this.imageData.data[g+1]=d,this.imageData.data[g+2]=e,this.imageData.data[g+3]=f},b}(GameObject),Vector2=function(){function a(a,b){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),this.x=a,this.y=b}return a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y)},a.prototype.sub=function(b){return new a(this.x-b.x,this.y-b.y)},a.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.angle=function(){return Math.atan2(this.x,this.y)},a}(),Tunnel=function(a){function b(){a.apply(this,arguments),this.lookUpTable=null,this.elapsed=0,this.imageData=null,this.doDraw=!1}return __extends(b,a),b.prototype.setTexture=function(a){this.texture=a},b.prototype.init=function(b){a.prototype.init.call(this,b),this.lookUpTable=new LookUpTable,this.lookUpTable.init(b)},b.prototype.update=function(a){this.doDraw=0!=a,this.elapsed+=10*a},b.prototype.draw=function(a){if(this.doDraw){this.imageData||(this.imageData=a.getImageData(0,0,this.gameManager.screen.width,this.gameManager.screen.height));for(var b=this.lookUpTable.dataViewAngle,c=this.lookUpTable.dataViewDistance,d=this.lookUpTable.dataViewDepth,e=Math.ceil(this.elapsed),f=this.gameManager.screen.width,g=this.gameManager.screen.height-1;g>=0;g--)for(var h=g*f,i=f-1;i>=0;i--){var j=i+h,k=c.getUint8(j)<<1,l=b.getUint8(j)<<1;k=(k+e)%this.texture.height,l=(l+e)%this.texture.width;var m=this.getColorAt(k,l);this.setPixel(i,g,m[0],m[1],m[2],d.getUint8(j))}a.putImageData(this.imageData,0,0)}},b.prototype.setPixel=function(a,b,c,d,e,f){var g=a+b*this.imageData.width<<2;this.imageData.data[g]=c,this.imageData.data[g+1]=d,this.imageData.data[g+2]=e,this.imageData.data[g+3]=f},b.prototype.getColorAt=function(a,b){var c=a+b*this.texture.width<<2;return[this.texture.data[c],this.texture.data[c+1],this.texture.data[c+2]]},b}(GameObject),ImageDataLoader=function(){function a(){this.image=new Image,this.canvas=document.createElement("canvas")}return a.prototype.load=function(a,b){this.image.src=a;var c=this;this.image.onload=function(){c.canvas.width=c.image.width,c.canvas.height=c.image.height,c.ctx=c.canvas.getContext("2d"),c.ctx.drawImage(c.image,0,0,c.image.width,c.image.height),c.imageData=c.ctx.getImageData(0,0,c.image.width,c.image.height),b&&b(c.imageData)}},a}();